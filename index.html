<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>V-League Stats Tracker</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        touch-action: manipulation;
      }

      html {
        color-scheme: light;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        background-attachment: fixed;
        min-height: 100vh;
        padding: 20px;
        font-size: 16px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: clamp(1.4em, 5vw, 2.5em);
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: clamp(0.875em, 2vw, 1em);
      }

      .input-section {
        background: white;
        padding: clamp(15px, 5vw, 30px);
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 30px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .input-group {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 15px;
        margin-bottom: 20px;
        align-items: center;
      }

      .input-group label {
        font-weight: bold;
        color: #333;
        white-space: nowrap;
      }

      .input-group input {
        padding: 12px 15px;
        border: 2px solid #667eea;
        border-radius: 5px;
        font-size: 16px;
      }

      .input-group input:focus {
        outline: none;
        border-color: #764ba2;
      }

      .button-group {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }

      button {
        padding: 12px 30px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        touch-action: manipulation;
      }

      .btn-start {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-reset {
        background: #ff6b6b;
        color: white;
      }

      .error {
        color: #ff6b6b;
        text-align: center;
        margin-top: 10px;
        font-weight: bold;
      }

      .sets-container {
        display: none;
      }

      .sets-container.active {
        display: block;
      }

      .set-section {
        margin-bottom: clamp(30px, 8vw, 40px);
      }

      .set-title {
        color: white;
        font-size: clamp(1.2em, 4vw, 1.8em);
        margin-bottom: 15px;
        text-align: center;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .table-wrapper {
        background: white;
        padding: clamp(12px, 4vw, 20px);
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 300px;
      }

      th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: clamp(10px, 3vw, 15px);
        text-align: center;
        font-weight: bold;
        font-size: clamp(0.75em, 2.5vw, 1em);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .set-1 th {
        background: #c4a084;
        color: #000;
      }

      .set-2 th {
        background: #ffd700;
        color: #000;
      }

      .set-3 th {
        background: #90ee90;
        color: #000;
      }

      .set-4 th {
        background: #ffb6c1;
        color: #000;
      }

      .set-5 th {
        background: #dda0dd;
        color: #000;
      }

      td {
        padding: clamp(8px, 2.5vw, 15px);
        text-align: center;
        border-bottom: 1px solid #e0e0e0;
        font-weight: 500;
        font-size: clamp(0.875em, 2vw, 1em);
      }

      td:first-child {
        text-align: left;
        background: #f8f9fa;
        font-weight: bold;
        color: #333;
        padding-left: clamp(8px, 3vw, 15px);
      }

      .stat-cell {
        user-select: none;
        border-radius: 5px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: clamp(6px, 2vw, 10px);
        flex-wrap: wrap;
      }

      .btn-increment {
        padding: clamp(6px, 2vw, 8px) clamp(10px, 3vw, 12px);
        font-size: clamp(0.875em, 2.5vw, 1em);
        font-weight: bold;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background: #667eea;
        color: white;
        min-width: 36px;
        min-height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .stat-value {
        min-width: clamp(30px, 8vw, 45px);
        text-align: center;
        font-weight: bold;
        font-size: clamp(0.875em, 2.5vw, 1.1em);
      }

      .stat-attacks {
        background: #00ff0d;
        color: #000;
        font-weight: bold;
      }

      .stat-blocks {
        background: #0008ff;
        color: #fff;
        font-weight: bold;
      }

      .stat-aces {
        background: #ffd000;
        color: #000;
        font-weight: bold;
      }

      .stat-opp-errors {
        background: #ff0000;
        color: #fff;
        font-weight: bold;
      }

      .score-input-section {
        background: white;
        padding: clamp(12px, 4vw, 20px);
        border-radius: 10px;
        margin-top: clamp(8px, 3vw, 15px);
        display: flex;
        align-items: center;
        gap: clamp(8px, 3vw, 15px);
        flex-wrap: wrap;
      }

      .score-input-section label {
        font-weight: bold;
        color: #333;
        white-space: nowrap;
      }

      .score-input-section input {
        padding: clamp(8px, 2.5vw, 12px);
        border: 2px solid #667eea;
        border-radius: 5px;
        font-size: clamp(0.875em, 2.5vw, 1em);
        width: clamp(80px, 20vw, 150px);
        text-align: center;
        touch-action: manipulation;
      }

      @media (max-width: 768px) {
        body {
          padding: 12px;
        }

        .input-group {
          grid-template-columns: 1fr;
        }

        .button-group {
          gap: 8px;
        }

        button {
          flex: 1;
          min-width: 120px;
          padding: 10px 16px;
          font-size: 14px;
        }

        .btn-increment {
          min-width: 40px;
          min-height: 40px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 8px;
        }

        .input-section {
          padding: 12px;
          margin-bottom: 16px;
        }

        .input-group {
          margin-bottom: 12px;
          gap: 8px;
        }

        .input-group label {
          font-size: 14px;
        }

        .input-group input {
          padding: 10px 12px;
          font-size: 16px;
        }

        button {
          padding: 10px 14px;
          font-size: 13px;
          min-width: 100px;
        }

        .btn-increment {
          min-width: 38px;
          min-height: 38px;
          padding: 4px 8px;
          font-size: 16px;
        }

        .stat-cell {
          flex-direction: row;
          gap: 4px;
        }

        .stat-value {
          min-width: 25px;
          font-size: 13px;
        }

        .button-group {
          gap: 6px;
        }

        .header {
          margin-bottom: 20px;
        }

        .set-section {
          margin-bottom: 20px;
        }

        table {
          min-width: 100%;
        }

        .score-input-section {
          margin-top: 10px;
        }

        .score-input-section input {
          font-size: 16px;
        }
      }

      @media (max-width: 360px) {
        .btn-increment {
          min-width: 32px;
          min-height: 32px;
          padding: 2px 6px;
        }

        .stat-cell {
          gap: 2px;
        }

        button {
          padding: 8px 12px;
          font-size: 12px;
        }

        .score-input-section {
          flex-direction: column;
          align-items: flex-start;
        }

        .score-input-section input {
          width: 100%;
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üèê KantiGo Sports - VLeague Stats</h1>
        <p>Track your team's performance across all sets</p>
      </div>

      <div class="input-section">
        <div class="input-group">
          <label>Team Name:</label>
          <input
            type="text"
            id="teamAInput"
            placeholder="Enter team name"
            value="Team A"
          />
        </div>
        <div class="button-group">
          <button class="btn-start" onclick="startGame()">Start Game</button>
          <button class="btn-reset" onclick="resetAll()">Reset All</button>
        </div>
        <div id="error" class="error"></div>
      </div>

      <div id="setsContainer" class="sets-container">
        <!-- Sets will be dynamically generated here -->
      </div>
    </div>

    <script>
      let teamA = "Team A";
      const stats = ["ATTACKS", "BLOCKS", "ACES", "OPP ERRORS"];
      const sets = [1, 2, 3, 4, 5];
      let gameData = {};

      // LocalStorage functions
      function saveGameData() {
        localStorage.setItem("gameData", JSON.stringify(gameData));
        localStorage.setItem("teamA", teamA);
      }

      function loadGameData() {
        const savedData = localStorage.getItem("gameData");
        const savedTeam = localStorage.getItem("teamA");

        if (savedData) {
          gameData = JSON.parse(savedData);
          if (savedTeam) {
            teamA = savedTeam;
            document.getElementById("teamAInput").value = teamA;
          }
          // If game data exists, show the sets container and render
          if (Object.keys(gameData).length > 0) {
            renderSets();
            document.getElementById("setsContainer").classList.add("active");
            // Restore score input values for each set
            sets.forEach((setNum) => {
              const scoreInput = document.getElementById(`score-set${setNum}`);
              if (scoreInput && gameData[setNum]["SCORE"]) {
                scoreInput.value = gameData[setNum]["SCORE"];
              }
            });
          }
        }
      }

      function initializeGameData() {
        gameData = {};
        sets.forEach((setNum) => {
          gameData[setNum] = {};
          stats.forEach((stat) => {
            gameData[setNum][stat] = 0;
          });
          gameData[setNum]["SCORE"] = 0;
        });
        saveGameData();
      }

      function startGame() {
        teamA = document.getElementById("teamAInput").value.trim();
        const errorDiv = document.getElementById("error");

        if (!teamA) {
          errorDiv.textContent = "Please enter team name!";
          return;
        }

        errorDiv.textContent = "";
        initializeGameData();
        renderSets();
        document.getElementById("setsContainer").classList.add("active");
        saveGameData();
      }

      function renderSets() {
        const container = document.getElementById("setsContainer");
        container.innerHTML = "";

        const fragment = document.createDocumentFragment();

        sets.forEach((setNum) => {
          const setSection = document.createElement("div");
          setSection.className = "set-section";

          const setTitle = document.createElement("div");
          setTitle.className = "set-title";
          setTitle.textContent = `Set ${setNum}`;

          const tableWrapper = document.createElement("div");
          tableWrapper.className = "table-wrapper";

          const table = document.createElement("table");
          table.className = `set-${setNum}`;
          const thead = document.createElement("thead");
          const headerRow = document.createElement("tr");

          const statsHeader = document.createElement("th");
          statsHeader.textContent = "Stats";
          const teamHeader = document.createElement("th");
          teamHeader.textContent = teamA;

          headerRow.appendChild(statsHeader);
          headerRow.appendChild(teamHeader);
          thead.appendChild(headerRow);
          table.appendChild(thead);

          const tbody = document.createElement("tbody");

          stats.forEach((stat) => {
            const row = document.createElement("tr");
            const statNameCell = document.createElement("td");
            statNameCell.textContent = stat;

            const statClass = `stat-${stat.toLowerCase().replace(/\s+/g, "-")}`;
            const dataCell = document.createElement("td");
            dataCell.className = `stat-cell ${statClass}`;
            dataCell.id = `set${setNum}-${stat}`;

            const valueSpan = document.createElement("span");
            valueSpan.className = "stat-value";
            valueSpan.textContent = gameData[setNum][stat];

            dataCell.appendChild(valueSpan);

            // Add +/- buttons for all stats (including OPP ERRORS)
            const decrementBtn = document.createElement("button");
            decrementBtn.className = "btn-increment";
            decrementBtn.textContent = "‚àí";
            decrementBtn.dataset.action = "decrement";
            decrementBtn.dataset.set = setNum;
            decrementBtn.dataset.stat = stat;

            const incrementBtn = document.createElement("button");
            incrementBtn.className = "btn-increment";
            incrementBtn.textContent = "+";
            incrementBtn.dataset.action = "increment";
            incrementBtn.dataset.set = setNum;
            incrementBtn.dataset.stat = stat;

            // Insert buttons: decrement, value, increment
            dataCell.insertBefore(decrementBtn, valueSpan);
            dataCell.appendChild(incrementBtn);

            row.appendChild(statNameCell);
            row.appendChild(dataCell);
            tbody.appendChild(row);
          });

          table.appendChild(tbody);
          tableWrapper.appendChild(table);
          setSection.appendChild(setTitle);
          setSection.appendChild(tableWrapper);

          // Add score input section
          const scoreSection = document.createElement("div");
          scoreSection.className = "score-input-section";

          const scoreLabel = document.createElement("label");
          scoreLabel.textContent = "Score:";

          const scoreInput = document.createElement("input");
          scoreInput.type = "number";
          scoreInput.min = "0";
          scoreInput.value = "0";
          scoreInput.id = `score-set${setNum}`;
          scoreInput.dataset.set = setNum;
          scoreInput.addEventListener("input", handleScoreChange);

          scoreSection.appendChild(scoreLabel);
          scoreSection.appendChild(scoreInput);
          setSection.appendChild(scoreSection);

          fragment.appendChild(setSection);
        });

        // Add totals section
        const totalsSection = document.createElement("div");
        totalsSection.className = "set-section";

        const totalsTitle = document.createElement("div");
        totalsTitle.className = "set-title";
        totalsTitle.textContent = "TOTALS";

        const tableWrapper = document.createElement("div");
        tableWrapper.className = "table-wrapper";

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        const statsHeader = document.createElement("th");
        statsHeader.textContent = "Stats";
        const teamHeader = document.createElement("th");
        teamHeader.textContent = teamA;

        headerRow.appendChild(statsHeader);
        headerRow.appendChild(teamHeader);
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");

        stats.forEach((stat) => {
          const row = document.createElement("tr");
          const statNameCell = document.createElement("td");
          statNameCell.textContent = stat;

          const statClass = `stat-${stat.toLowerCase().replace(/\s+/g, "-")}`;
          const dataCell = document.createElement("td");
          dataCell.className = `stat-cell ${statClass}`;
          dataCell.id = `total-${stat}`;

          const valueSpan = document.createElement("span");
          valueSpan.className = "stat-value";
          valueSpan.textContent = "0";

          dataCell.appendChild(valueSpan);

          row.appendChild(statNameCell);
          row.appendChild(dataCell);
          tbody.appendChild(row);
        });

        table.appendChild(tbody);
        tableWrapper.appendChild(table);
        totalsSection.appendChild(totalsTitle);
        totalsSection.appendChild(tableWrapper);
        fragment.appendChild(totalsSection);

        container.appendChild(fragment);

        // Event delegation for stat buttons
        container.addEventListener("click", handleStatClick);

        // Initialize totals display
        updateTotals();
      }

      function calculateTotals() {
        const totals = {};
        stats.forEach((stat) => {
          totals[stat] = 0;
          sets.forEach((setNum) => {
            totals[stat] += gameData[setNum][stat];
          });
        });
        return totals;
      }

      function updateTotals() {
        const totals = calculateTotals();
        stats.forEach((stat) => {
          const cellId = `total-${stat}`;
          const cell = document.getElementById(cellId);
          if (cell) {
            const valueSpan = cell.querySelector(".stat-value");
            valueSpan.textContent = totals[stat];
          }
        });
      }

      function handleScoreChange(event) {
        const setNum = parseInt(event.target.dataset.set, 10);
        const score = parseInt(event.target.value, 10) || 0;

        // Save score value
        gameData[setNum]["SCORE"] = score;

        // Calculate OPP ERRORS = Score - (Attacks + Blocks + Aces)
        const attacks = gameData[setNum]["ATTACKS"];
        const blocks = gameData[setNum]["BLOCKS"];
        const aces = gameData[setNum]["ACES"];
        const oppErrors = score - (attacks + blocks + aces);

        gameData[setNum]["OPP ERRORS"] = Math.max(0, oppErrors);
        updateStatDisplay(setNum, "OPP ERRORS");
        saveGameData();
      }

      function updateScoreFromStats(setNum) {
        // Calculate score from: Score = OPP ERRORS + (Attacks + Blocks + Aces)
        const attacks = gameData[setNum]["ATTACKS"];
        const blocks = gameData[setNum]["BLOCKS"];
        const aces = gameData[setNum]["ACES"];
        const oppErrors = gameData[setNum]["OPP ERRORS"];

        const scoreInput = document.getElementById(`score-set${setNum}`);
        if (scoreInput) {
          const calculatedScore = oppErrors + (attacks + blocks + aces);
          // Update the visible input
          scoreInput.value = calculatedScore;
          // Persist the calculated score into gameData so it is saved
          gameData[setNum]["SCORE"] = calculatedScore;
        }
      }

      function handleStatClick(event) {
        const button = event.target.closest(".btn-increment");
        if (!button) return;

        const setNum = parseInt(button.dataset.set, 10);
        const stat = button.dataset.stat;
        const action = button.dataset.action;

        if (action === "increment") {
          incrementStat(setNum, stat);
        } else if (action === "decrement") {
          decrementStat(setNum, stat);
        }
      }

      function incrementStat(setNum, stat) {
        gameData[setNum][stat]++;
        updateStatDisplay(setNum, stat);
        // Always update score when any stat changes (including OPP ERRORS)
        updateScoreFromStats(setNum);
        saveGameData();
      }

      function decrementStat(setNum, stat) {
        if (gameData[setNum][stat] > 0) {
          gameData[setNum][stat]--;
          updateStatDisplay(setNum, stat);
          // Always update score when any stat changes (including OPP ERRORS)
          updateScoreFromStats(setNum);
          saveGameData();
        }
      }

      function updateStatDisplay(setNum, stat) {
        const cellId = `set${setNum}-${stat}`;
        const cell = document.getElementById(cellId);
        const valueSpan = cell.querySelector(".stat-value");
        valueSpan.textContent = gameData[setNum][stat];
        updateTotals();
      }

      function resetAll() {
        document.getElementById("teamAInput").value = "Team A";
        document.getElementById("error").textContent = "";
        document.getElementById("setsContainer").classList.remove("active");
        initializeGameData();
        localStorage.removeItem("gameData");
        localStorage.removeItem("teamA");
      }

      // Initialize on page load
      window.addEventListener("load", () => {
        loadGameData();
      });
    </script>
  </body>
</html>
